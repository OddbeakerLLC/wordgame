<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>System Audio Generator - Word Master Challenge</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            font-family: system-ui, -apple-system, sans-serif;
        }
        .log-entry {
            padding: 0.5rem;
            border-bottom: 1px solid #e5e7eb;
        }
        .log-success { background-color: #d1fae5; }
        .log-error { background-color: #fee2e2; }
        .log-info { background-color: #dbeafe; }
    </style>
</head>
<body class="bg-gray-100 p-8">
    <div class="max-w-4xl mx-auto">
        <div class="bg-white rounded-lg shadow-lg p-8">
            <h1 class="text-3xl font-bold text-blue-600 mb-2">üéôÔ∏è System Audio Generator</h1>
            <p class="text-gray-600 mb-6">Generate ElevenLabs audio for alphabet letters and system prompts</p>

            <div class="mb-6 p-4 bg-yellow-50 border-2 border-yellow-300 rounded-lg">
                <h3 class="font-bold text-gray-800 mb-2">üìã What Will Be Generated</h3>
                <ul class="list-disc list-inside text-sm text-gray-700 space-y-1">
                    <li><strong>26 Letters:</strong> A through Z (for spelling mode)</li>
                    <li><strong>System Prompts:</strong> "Let's learn a new word", "Spell", etc.</li>
                    <li><strong>Total:</strong> ~30 audio files</li>
                    <li><strong>Storage:</strong> Save as JSON file for app integration</li>
                </ul>
            </div>

            <div class="mb-6">
                <h3 class="text-xl font-bold text-gray-800 mb-3">Generation Settings</h3>
                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-semibold text-gray-700 mb-2">
                            Delay Between Requests (ms)
                        </label>
                        <input type="number" id="delay-input" value="500" min="0" max="5000"
                               class="w-full px-3 py-2 border-2 border-gray-300 rounded-lg focus:border-blue-500 focus:outline-none">
                        <p class="text-xs text-gray-500 mt-1">500ms recommended</p>
                    </div>
                    <div>
                        <label class="block text-sm font-semibold text-gray-700 mb-2">
                            Total Items
                        </label>
                        <input type="text" id="total-count" value="30" disabled
                               class="w-full px-3 py-2 border-2 border-gray-300 rounded-lg bg-gray-50">
                    </div>
                </div>
            </div>

            <div class="mb-6">
                <button id="test-btn"
                        class="w-full bg-purple-600 hover:bg-purple-700 text-white font-bold py-3 px-6 rounded-lg transition-colors mb-3">
                    üß™ Test API Connection
                </button>
                <button id="start-btn"
                        class="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-4 px-6 rounded-lg transition-colors">
                    üéôÔ∏è Start System Audio Generation
                </button>
                <button id="download-btn" disabled
                        class="w-full mt-3 bg-green-600 hover:bg-green-700 text-white font-bold py-4 px-6 rounded-lg transition-colors disabled:bg-gray-400 disabled:cursor-not-allowed">
                    ‚¨áÔ∏è Download System Audio (JSON)
                </button>
            </div>

            <div class="mb-6">
                <div class="flex items-center justify-between mb-2">
                    <h3 class="text-xl font-bold text-gray-800">Progress</h3>
                    <span id="progress-text" class="text-sm text-gray-600">0 / 30</span>
                </div>
                <div class="w-full bg-gray-200 rounded-full h-6 overflow-hidden">
                    <div id="progress-bar" class="bg-blue-600 h-6 transition-all duration-300 flex items-center justify-center text-white text-sm font-semibold" style="width: 0%">
                        0%
                    </div>
                </div>
            </div>

            <div class="mb-6">
                <h3 class="text-xl font-bold text-gray-800 mb-3">Generation Log</h3>
                <div id="log-container" class="bg-gray-50 border-2 border-gray-300 rounded-lg max-h-96 overflow-y-auto">
                    <div class="log-entry log-info">Ready to start generation...</div>
                </div>
            </div>

            <div class="bg-blue-50 border-2 border-blue-300 rounded-lg p-4">
                <h4 class="font-bold text-gray-800 mb-2">üí° Integration Instructions</h4>
                <ol class="text-sm text-gray-700 space-y-1 list-decimal list-inside">
                    <li>Generate and download the JSON file</li>
                    <li>Create a new service file: <code class="bg-gray-200 px-1 rounded">src/services/systemAudio.js</code></li>
                    <li>Import the JSON data and provide helper functions</li>
                    <li>Update TTS service to check for system audio first</li>
                </ol>
            </div>
        </div>
    </div>

    <script type="module">
        // Phoneme pronunciations for letter names using IPA (International Phonetic Alphabet)
        // ElevenLabs supports <phoneme> tags for precise pronunciation control
        const LETTER_PRONUNCIATIONS = {
            'A': '<phoneme alphabet="ipa" ph="e…™">A</phoneme>',
            'B': '<phoneme alphabet="ipa" ph="biÀê">B</phoneme>',
            'C': '<phoneme alphabet="ipa" ph="siÀê">C</phoneme>',
            'D': '<phoneme alphabet="ipa" ph="diÀê">D</phoneme>',
            'E': '<phoneme alphabet="ipa" ph="iÀê">E</phoneme>',
            'F': '<phoneme alphabet="ipa" ph="…õf">F</phoneme>',
            'G': '<phoneme alphabet="ipa" ph="d íiÀê">G</phoneme>',
            'H': '<phoneme alphabet="ipa" ph="e…™t É">H</phoneme>',
            'I': '<phoneme alphabet="ipa" ph="a…™">I</phoneme>',
            'J': '<phoneme alphabet="ipa" ph="d íe…™">J</phoneme>',
            'K': '<phoneme alphabet="ipa" ph="ke…™">K</phoneme>',
            'L': '<phoneme alphabet="ipa" ph="…õl">L</phoneme>',
            'M': '<phoneme alphabet="ipa" ph="…õm">M</phoneme>',
            'N': '<phoneme alphabet="ipa" ph="…õn">N</phoneme>',
            'O': '<phoneme alphabet="ipa" ph="o ä">O</phoneme>',
            'P': '<phoneme alphabet="ipa" ph="piÀê">P</phoneme>',
            'Q': '<phoneme alphabet="ipa" ph="kjuÀê">Q</phoneme>',
            'R': '<phoneme alphabet="ipa" ph="…ër">R</phoneme>',
            'S': '<phoneme alphabet="ipa" ph="…õs">S</phoneme>',
            'T': '<phoneme alphabet="ipa" ph="tiÀê">T</phoneme>',
            'U': '<phoneme alphabet="ipa" ph="juÀê">U</phoneme>',
            'V': '<phoneme alphabet="ipa" ph="viÀê">V</phoneme>',
            'W': '<phoneme alphabet="ipa" ph="d åb…ôljuÀê">W</phoneme>',
            'X': '<phoneme alphabet="ipa" ph="…õks">X</phoneme>',
            'Y': '<phoneme alphabet="ipa" ph="wa…™">Y</phoneme>',
            'Z': '<phoneme alphabet="ipa" ph="ziÀê">Z</phoneme>'
        };

        // System audio items to generate
        const ALPHABET = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ'.split('');
        const SYSTEM_PROMPTS = [
            "Let's learn a new word",
            "Spell",
            "Great job",
            "Try again",
            "Great spelling",
            "Now let's read",
            "Read this word out loud then check your answer",
            "Here is the next word",
            "Did you get it?"
        ];

        const ALL_ITEMS = [
            ...ALPHABET.map(letter => ({
                type: 'letter',
                text: letter,
                pronunciation: LETTER_PRONUNCIATIONS[letter]
            })),
            ...SYSTEM_PROMPTS.map(prompt => ({ type: 'prompt', text: prompt }))
        ];

        let generatedData = [];
        let isGenerating = false;

        const testBtn = document.getElementById('test-btn');
        const startBtn = document.getElementById('start-btn');
        const downloadBtn = document.getElementById('download-btn');
        const progressBar = document.getElementById('progress-bar');
        const progressText = document.getElementById('progress-text');
        const logContainer = document.getElementById('log-container');
        const delayInput = document.getElementById('delay-input');
        const totalCount = document.getElementById('total-count');

        totalCount.value = ALL_ITEMS.length;

        function addLog(message, type = 'info') {
            const entry = document.createElement('div');
            entry.className = `log-entry log-${type}`;
            entry.textContent = `[${new Date().toLocaleTimeString()}] ${message}`;
            logContainer.appendChild(entry);
            logContainer.scrollTop = logContainer.scrollHeight;
        }

        function updateProgress(current, total) {
            const percentage = Math.round((current / total) * 100);
            progressBar.style.width = `${percentage}%`;
            progressBar.textContent = `${percentage}%`;
            progressText.textContent = `${current} / ${total}`;
        }

        const API_ENDPOINT = prompt(
            'Enter your PHP API endpoint URL:',
            'http://localhost:8080/api/tts.php'
        );

        if (!API_ENDPOINT) {
            alert('API endpoint is required!');
            throw new Error('No API endpoint provided');
        }

        async function generateAudio(text) {
            try {
                const response = await fetch(API_ENDPOINT, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ text }),
                });

                const rawText = await response.text();
                let data;
                try {
                    data = JSON.parse(rawText);
                } catch (jsonError) {
                    console.error('Raw response:', rawText);
                    throw new Error(`Invalid JSON response. First 200 chars: ${rawText.substring(0, 200)}`);
                }

                if (!response.ok) {
                    throw new Error(data.error || 'Generation failed');
                }

                if (!data.success || !data.audio) {
                    throw new Error('Invalid response structure');
                }

                return data.audio;

            } catch (error) {
                throw error;
            }
        }

        async function testAPIConnection() {
            testBtn.disabled = true;
            testBtn.textContent = 'Testing...';
            addLog('Testing API connection...', 'info');

            try {
                addLog(`Testing CORS preflight to: ${API_ENDPOINT}`, 'info');
                const optionsResponse = await fetch(API_ENDPOINT, {
                    method: 'OPTIONS',
                    headers: {
                        'Content-Type': 'application/json',
                    }
                });

                if (optionsResponse.ok) {
                    addLog('‚úì CORS preflight successful', 'success');
                } else {
                    addLog(`‚ö† CORS preflight failed: ${optionsResponse.status}`, 'error');
                }

                addLog('Testing POST request...', 'info');
                const audio = await generateAudio('test');

                if (audio) {
                    const sizeKB = (audio.length / 1024).toFixed(1);
                    addLog(`‚úì API test successful! Generated ${sizeKB} KB of audio`, 'success');
                    testBtn.textContent = '‚úì API Connected';
                    testBtn.classList.add('bg-green-600');
                } else {
                    addLog('‚úó API returned no audio data', 'error');
                    testBtn.textContent = '‚úó Test Failed';
                    testBtn.classList.add('bg-red-600');
                }
            } catch (error) {
                addLog(`‚úó API test failed: ${error.message}`, 'error');
                addLog(`Make sure your PHP server is running at: ${API_ENDPOINT}`, 'error');
                testBtn.textContent = '‚úó Connection Failed';
                testBtn.classList.add('bg-red-600');
            } finally {
                setTimeout(() => {
                    testBtn.disabled = false;
                    testBtn.textContent = 'üß™ Test API Connection';
                    testBtn.classList.remove('bg-green-600', 'bg-red-600');
                }, 3000);
            }
        }

        async function startGeneration() {
            if (isGenerating) return;

            isGenerating = true;
            startBtn.disabled = true;
            downloadBtn.disabled = true;
            generatedData = [];
            logContainer.innerHTML = '';

            const delay = parseInt(delayInput.value);

            addLog(`Starting generation for ${ALL_ITEMS.length} items...`, 'info');
            addLog(`Delay between requests: ${delay}ms`, 'info');

            let successCount = 0;
            let failCount = 0;

            for (let i = 0; i < ALL_ITEMS.length; i++) {
                const item = ALL_ITEMS[i];

                try {
                    // Use pronunciation for letters (e.g., "ay" instead of "A")
                    const textToGenerate = item.pronunciation || item.text;
                    addLog(`Generating audio for "${item.text}" (${item.type})...`, 'info');
                    const audioBase64 = await generateAudio(textToGenerate);

                    generatedData.push({
                        type: item.type,
                        text: item.text,
                        audioBase64: audioBase64
                    });

                    successCount++;
                    addLog(`‚úì Generated "${item.text}" as "${textToGenerate}" (${(audioBase64.length / 1024).toFixed(1)} KB)`, 'success');

                } catch (error) {
                    failCount++;
                    addLog(`‚úó Failed to generate "${item.text}": ${error.message}`, 'error');

                    generatedData.push({
                        type: item.type,
                        text: item.text,
                        audioBase64: null
                    });
                }

                updateProgress(i + 1, ALL_ITEMS.length);

                if (i < ALL_ITEMS.length - 1) {
                    await new Promise(resolve => setTimeout(resolve, delay));
                }
            }

            addLog(`Generation complete! Success: ${successCount}, Failed: ${failCount}`, 'success');
            addLog(`Click "Download System Audio" to save the results`, 'info');

            isGenerating = false;
            startBtn.disabled = false;
            downloadBtn.disabled = false;
        }

        function downloadData() {
            const dataStr = JSON.stringify(generatedData, null, 2);
            const dataBlob = new Blob([dataStr], { type: 'application/json' });
            const url = URL.createObjectURL(dataBlob);

            const link = document.createElement('a');
            link.href = url;
            link.download = `system-audio-${Date.now()}.json`;
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            URL.revokeObjectURL(url);

            addLog('System audio data downloaded!', 'success');
        }

        testBtn.addEventListener('click', testAPIConnection);
        startBtn.addEventListener('click', startGeneration);
        downloadBtn.addEventListener('click', downloadData);
    </script>
</body>
</html>
